## Lab 1: FPGA and MCU Setup and Testing

### Introduction
The goal of Lab 1 was to set up the FPGA and MCU board and design a circuit that controls three onboard LEDs and a common cathode 7-segment display using four DIP switches. The 7-segment display is capable of displaying a single hexadecimal digit, while the LEDs are used to indicate different conditions based on the state of the DIP switches. Specifically, one LED is activated when one of the first two DIP switches is turned on, another LED is turned on when both of the last two DIP switches are on, and a third LED blinks at a frequency of approximately 2.4 Hz. This setup is designed to demonstrate basic digital logic functionality, display control, and LED behavior using an FPGA.

### Design and Testing Methodology
The FPGA design is based on a clock divider and display decoder to manage the various outputs. The onboard low-speed oscillator (LSOSC) from the iCE40 UltraPlus primitive library is used, which operates at a frequency of 10 kHz. This clock frequency is suitable for generating a 2.4 Hz signal for the blinking LED. A clock divider module is implemented in Verilog to divide the 10 kHz clock signal down to the desired frequency. Specifically, a counter is used within the clock divider to produce the necessary 2.4 Hz signal, which will toggle the blinking LED.

The 7-segment display consists of diodes for each segment, where the FPGA output signals drive the diodes low to light them up. The design ensures that the diodes on the 7-segment display receive a current draw between 5 mA and 20 mA while maintaining a forward voltage of around 2.1 V. This is important to prevent damage to the diodes and to ensure proper display brightness. To achieve this, a current-limiting resistor is placed in series with each segment. The value of the resistor is calculated to allow the proper current range through the diodes. After testing various resistor values, I selected a 68-ohm resistor to ensure the optimal current and brightness for the display.

The fs DIP switches are used as inputs to control the state of the LEDs. The first two DIP switches control one LED, while the last two DIP switches control another LED. A third LED blinks at a frequency of approximately 2.4 Hz, generated by the clock divider.

#### Resistor Calculation for 7-Segment Display
To determine the appropriate value for the current-limiting resistors for the 7-segment display, I used the following approach:

1. **Forward voltage of LED (Vf):** 2.1 V (typical for standard red LEDs).
2. **Supply voltage (Vcc):** 3.3 V.
3. **Desired current (I):** Between 5 mA and 20 mA.

Using Ohm's law, the resistor value is calculated as:

$$
R = \frac{V_{cc} - V_f}{I}
$$

For a maximum current of 20 mA:

$$
R = \frac{3.3 \, \text{V} - 2.1 \, \text{V}}{0.02 \, \text{A}} = 60 \, \Omega
$$

This is the maximum resistance value. Since I want to limit the current to below 20 mA, a resistor of 68 ohms was chosen as it provides a good balance between brightness and current safety.

### Technical Documentation
The source code for the FPGA project, including the Verilog code for the clock divider and 7-segment decoder modules, can be found in the associated [GitHub repository](https://github.com/ZhianZ/e155-lab1/tree/main).

#### Block Diagram
![](./images/lab1_block_diagram.JPG)
*Figure 1. Block diagram of the Verilog design*

The block diagram in Figure 1 illustrates the architecture of the design. The top-level module (`top`) contains two submodules:
1. **Clock Divider (`clock_divider`)**: This module is responsible for dividing the 10 kHz clock to generate the 2.4 Hz signal needed for blinking one of the LEDs.
2. **7-Segment Decoder (`seven_seg_decoder`)**: This module takes a 4-bit input (the DIP switches) and decodes it to control the appropriate segments of the 7-segment display, outputting the corresponding hexadecimal digit.

#### Schematic
![](./images/lab1_schematics.JPG)
*Figure 2. Schematic of the physical circuit*

Figure 2 shows the physical layout of the design, illustrating how the DIP switches, LEDs, and 7-segment display are connected to the FPGA.

### Results and Discussion
#### Testbench Simulation
![](./images/seven_seg_decoder_wave.png)
*Figure 3. A screenshot of a QuestaSim simulation demonstrating the display output is identical to the expected output.*

The simulation results in Figure 3 confirm that the 7-segment display outputs the correct hexadecimal digits corresponding to the input from the DIP switches. The expected output was verified through a testbench simulation in QuestaSim, where the values of the DIP switches were varied and the display output was observed to match the correct hexadecimal digit for each case. This demonstrates that the `seven_seg_decoder` module is functioning as intended.

#### LED Behavior
The LEDs function as expected based on the states of the DIP switches. When one of the first two DIP switches is turned on, the first LED lights up. When both of the last two DIP switches are on, the second LED lights up. The third LED blinks at a rate of approximately 2.4 Hz, as determined by the clock divider module. This blinking frequency was validated through measurement and observation using an oscilloscope.

The resistor values used in the 7-segment display circuitry were verified to be appropriate, as the display was bright and functional without overloading the diodes. The current-limiting resistors ensured that the diodes were not damaged, and the display showed clear, readable digits.

### Conclusion
The design successfully implemented the control of three onboard LEDs and a 7-segment display using four DIP switches on the FPGA. The clock divider module accurately generated a 2.4 Hz signal, which caused the third LED to blink as expected. The 7-segment display showed the correct hexadecimal digits based on the DIP switch inputs, and the LEDs responded correctly to the switch settings. The resistor values for the current-limiting resistors were chosen appropriately, ensuring both the proper brightness of the display and the safety of the diodes. I spent a total of 8 hours working on this lab.